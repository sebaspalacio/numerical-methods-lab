<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Numerical Methods Lab ‚Äî Roots & Gaussian Elimination</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <style>
    /* ===== Adventure Time‚Äìish Theme ===== */
    :root{
      --c-bg:#fcfbff; --c-card:#ffffff; --c-ink:#18212f; --c-soft:#6b7280;
      --c-primary:#7c3aed; --c-primary-2:#22d3ee; --c-accent:#f472b6; --c-lime:#a3e635;
      --rad:20px;
    }
    body{ background: radial-gradient(1200px 700px at 10% -20%, #fef6ff, transparent),
                       radial-gradient(800px 600px at 110% 10%, #ecfeff, transparent),
                       var(--c-bg); color:var(--c-ink); }
    .title{ font-weight:900; letter-spacing:.2px; }
    .card{ background:var(--c-card); border-radius:var(--rad); box-shadow:0 20px 40px rgba(24,33,47,.05); padding:1.25rem; }
    .btn{ border-radius:14px; padding:.6rem 1rem; font-weight:600; }
    .btn-primary{ background:linear-gradient(90deg,var(--c-primary),var(--c-primary-2)); color:#fff; }
    .btn-primary:hover{ filter:brightness(1.03); }
    .btn-soft{ background:#f3f4f6; color:#111827; }
    .btn-soft:hover{ background:#e5e7eb; }
    .select,.input,textarea{ width:100%; border:1px solid #e5e7eb; border-radius:14px; padding:.55rem .8rem; outline:none; }
    .select:focus,.input:focus,textarea:focus{ box-shadow:0 0 0 3px rgba(124,58,237,.15); border-color:#ddd6fe; }
    .badge{ display:inline-block; padding:.2rem .6rem; border-radius:999px; font-size:.75rem; font-weight:700; }
    .ok{ background:#ecfeff; color:#0e7490; }
    .warn{ background:#fff7ed; color:#b45309; }
    .err{ background:#fee2e2; color:#991b1b; }
    .hint{ color:#6b7280; font-size:.9rem; }
    .table{ width:100%; border-collapse:collapse; }
    .table th,.table td{ border-bottom:1px solid #eef2f7; padding:.55rem; text-align:right; font-variant-numeric:tabular-nums; }
    .table th{ color:#374151; text-align:center; }
    .code{ font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
           background:#f8fafc; padding:.15rem .35rem; border-radius:8px; font-size:.85rem; }
    .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    @media (max-width:1024px){ .grid-2{ grid-template-columns:1fr; } }

    /* History modal */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:50; }
    .modal.open{ display:flex; }
    .modal-card{ max-height:80vh; overflow:auto; width:min(960px,95vw); }
    .chip{ display:inline-block; padding:.15rem .5rem; border-radius:999px; background:#f3f4f6; font-size:.75rem; font-weight:700; }
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-7xl mx-auto p-4 lg:p-8">
    <!-- Hero -->
    <header class="mb-6">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-2xl grid place-items-center text-xl" style="background:conic-gradient(from 180deg,#fff 0deg,#fff 260deg,#f1f5f9 360deg)">üßÅ</div>
        <h1 class="title text-3xl">Numerical Methods Lab</h1>
      </div>
      <p class="hint mt-2">Pick a method, enter your data, and the app will guide you. If a method can‚Äôt be applied, you‚Äôll get gentle hints to fix it ‚Äî like a friendly side-quest üó∫Ô∏è.</p>
    </header>

    <!-- Controls -->
    <div class="card mb-6">
      <div class="grid lg:grid-cols-[1fr,1fr,1fr,auto] gap-4 items-end">
        <div>
          <label class="block text-sm font-semibold mb-1">Workspace</label>
          <div class="flex gap-2">
            <button id="tabRoot" class="btn btn-primary" aria-pressed="true">Root Finding</button>
            <button id="tabLinear" class="btn btn-soft" aria-pressed="false">Linear Systems</button>
          </div>
          <p class="hint mt-2">Toggle between <span class="code">f(x)=0</span> solvers and Gaussian elimination.</p>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1">Method</label>
          <!-- JS populates this select according to workspace -->
          <select id="methodSelect" class="select"></select>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1">Presets (Try it!)</label>
          <div class="flex gap-2">
            <select id="presetSelect" class="select"></select>
            <button id="loadPresetBtn" class="btn btn-soft">Load</button>
          </div>
        </div>

        <div class="flex gap-2">
          <button id="runBtn" class="btn btn-primary w-full">Run</button>
          <button id="resetBtn" class="btn btn-soft w-full">Reset</button>
          <button id="historyBtn" class="btn btn-soft w-full">History</button>
        </div>
      </div>
    </div>

    <!-- ROOT PANEL -->
    <section id="rootPanel" class="card mb-6">
      <div class="grid-2">
        <div>
          <h2 class="text-lg font-semibold mb-3">Inputs ‚Äî Root Finding</h2>

          <label class="block text-sm font-semibold mb-1">f(x)</label>
          <input id="fxInput" class="input" value="x**3 - 7*x + 6" placeholder="Example: x**3 - 7*x + 6" />
          <p class="hint mb-3">You can use <span class="code">sin</span>, <span class="code">cos</span>, <span class="code">exp</span>, <span class="code">log</span>, <span class="code">sqrt</span>. <em>x^2</em> auto-converts to <em>x**2</em>.</p>

          <div id="gxGroup" class="hidden">
            <label class="block text-sm font-semibold mb-1">g(x) (for Fixed Point)</label>
            <input id="gxInput" class="input" value="(x + (7*x - 6)/3)/2" placeholder="Contractive mapping preferred" />
            <p class="hint mb-3">Tip: aim for max |g'(x)| &lt; 1 on your interval.</p>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm font-semibold mb-1">Interval a</label>
              <input id="aInput" type="number" class="input" value="0.5"/>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Interval b</label>
              <input id="bInput" type="number" class="input" value="3.0"/>
            </div>
          </div>

          <div id="deltaGroup" class="grid grid-cols-2 gap-3 mt-3 hidden">
            <div>
              <label class="block text-sm font-semibold mb-1">Delta</label>
              <input id="deltaInput" type="number" class="input" value="0.5" step="0.1"/>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Max steps</label>
              <input id="nmaxInput" type="number" class="input" value="100"/>
            </div>
          </div>

          <div id="x0x1Group" class="grid grid-cols-2 gap-3 mt-3">
            <div>
              <label class="block text-sm font-semibold mb-1">x0</label>
              <input id="x0Input" type="number" class="input" value="1.5"/>
            </div>
            <div id="x1Col">
              <label class="block text-sm font-semibold mb-1">x1 (Secant)</label>
              <input id="x1Input" type="number" class="input" value="2.5"/>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3 mt-3">
            <div>
              <label class="block text-sm font-semibold mb-1">Tolerance</label>
              <input id="tolInput" type="number" class="input" value="1e-6"/>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Max iterations</label>
              <input id="kmaxInput" type="number" class="input" value="100"/>
            </div>
          </div>
        </div>

        <div>
          <h2 class="text-lg font-semibold mb-3">Status & Guidance</h2>
          <div id="alertsBox" class="space-y-2 mb-4"></div>
          <div id="summaryBox" class="mb-4"></div>
          <div id="plot" class="w-full rounded-xl border border-gray-200" style="height:480px"></div>
        </div>
      </div>

      <div id="tableBox" class="mt-6">
        <h3 class="text-lg font-semibold mb-2">Iterations</h3>
        <div class="overflow-auto rounded-xl border border-gray-200">
          <table id="iterTable" class="table"></table>
        </div>
        <div id="last3Box" class="mt-3"></div>
      </div>
    </section>

    <!-- LINEAR PANEL -->
    <section id="linearPanel" class="card mb-6 hidden">
      <div class="grid-2">
        <div>
          <h2 class="text-lg font-semibold mb-3">Inputs ‚Äî Gaussian Elimination</h2>

          <!-- Matrix input mode -->
          <div class="flex gap-2 mb-3">
            <button id="modePaste" class="btn btn-primary" aria-pressed="true">Paste Matrix</button>
            <button id="modeBuild" class="btn btn-soft" aria-pressed="false">Build Matrix</button>
          </div>

          <!-- PASTE MODE -->
          <div id="pastePanel">
            <label class="block text-sm font-semibold mb-1">Matrix A (rows by newline; values by space or comma)</label>
            <textarea id="AInput" class="input" rows="6">2 -1 0 3
1 0.5 3 8
0 13 -2 11
14 5 -2 3</textarea>

            <label class="block text-sm font-semibold mt-3 mb-1">Vector b</label>
            <input id="bVecInput" class="input" value="1 1 1 1" />
          </div>

          <!-- BUILD MODE -->
          <div id="buildPanel" class="hidden">
            <div class="grid grid-cols-3 gap-3 mb-3">
              <div>
                <label class="block text-sm font-semibold mb-1">Size n</label>
                <input id="nSizeInput" type="number" class="input" value="3" min="1" max="8"/>
              </div>
              <div class="flex items-end">
                <button id="buildBtn" class="btn btn-soft w-full">Build matrix</button>
              </div>
              <div class="flex items-end">
                <button id="clearGridBtn" class="btn btn-soft w-full">Clear</button>
              </div>
            </div>

            <div class="grid lg:grid-cols-[1fr,auto] gap-6">
              <div><div id="AGrid"></div></div>
              <div><div id="bGrid"></div></div>
            </div>

            <p class="hint mt-2">Type numbers into the grid. You can switch back to ‚ÄúPaste Matrix‚Äù anytime.</p>
          </div>

          <div class="grid grid-cols-2 gap-3 mt-4">
            <div>
              <label class="block text-sm font-semibold mb-1">Tolerance (pivot check)</label>
              <input id="ltolInput" type="number" class="input" value="1e-12"/>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">Pivoting</label>
              <select id="pivotSelect" class="select">
                <option value="gaussNone">No Pivoting</option>
                <option value="gaussPartial">Partial Pivoting</option>
                <option value="gaussTotal">Total Pivoting</option>
              </select>
            </div>
          </div>
        </div
